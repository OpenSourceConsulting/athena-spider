{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "VmHostController"
    },
    "designerId": "3283cfec-d919-4cd8-bb52-ac024c98ec9c",
    "cn": [
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "application"
                ],
                "fn": "init",
                "implHandler": [
                    "var vmHostTree = this;",
                    "",
                    "var vmHostContextMenu = new Ext.menu.Menu({",
                    "    items:",
                    "    [",
                    "        { text: 'NIC 관리',",
                    "         handler: function() {",
                    "             alert('NIC 관리');",
                    "         }",
                    "        },",
                    "        { text: '라우팅',",
                    "         handler: function() {",
                    "             alert('라우팅');",
                    "         }",
                    "        },",
                    "        { text: '파이어월',",
                    "         handler: function() {",
                    "             alert('파이어월');",
                    "         }",
                    "        },",
                    "        { text: 'NAT 관리',",
                    "         handler: function() {",
                    "             alert('NAT 관리');",
                    "         }",
                    "        },",
                    "        {",
                    "            xtype: 'menuseparator'",
                    "        },",
                    "        { text: 'VM 시작/중단',",
                    "         handler: function() {",
                    "             alert('VM 시작/중단');",
                    "         }",
                    "        },",
                    "        { text: 'VM 삭제',",
                    "         handler: function() {",
                    "             vmHostTree.deleteVm();",
                    "         }",
                    "        }",
                    "    ]",
                    "",
                    "});",
                    "",
                    "//VM Host Tree Constants",
                    "Ext.define('vmHostConstants', {",
                    "    singleton: true,",
                    "    me : vmHostTree,",
                    "",
                    "    contextMenu: vmHostContextMenu,",
                    "    selectRecord : null,",
                    "    actionRecord : null",
                    "});"
                ]
            },
            "designerId": "41ca8b61-0d4f-4c20-85b8-41ed09d9d752"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "popAddVMHostWindow",
                "implHandler": [
                    "//VM Host 생성 팝업 호출",
                    "",
                    "var popWindow = Ext.create(\"widget.AddVmHostWindow\");",
                    "popWindow.show();"
                ]
            },
            "designerId": "83cf192e-5325-4af7-b31d-4cc82152576f"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#listMenuPanel",
                "designer|targetType": "Ext.tree.Panel",
                "fn": "onListMenuPanelBeforeItemContextMenu",
                "implHandler": [
                    "",
                    "if(record.get(\"type\") === 'vm') {",
                    "",
                    "    var position = e.getXY();",
                    "    e.stopEvent();",
                    "",
                    "    vmHostConstants.actionRecord = record;",
                    "",
                    "    Ext.Ajax.request({",
                    "        url: GLOBAL.apiUrlPrefix + 'mon/vm/' + record.get(\"vmhost\") + \"/\" + record.get(\"text\") + \"/status\",",
                    "        method : 'GET',",
                    "        disableCaching : true,",
                    "        success: function(response){",
                    "",
                    "            var data = Ext.JSON.decode(response.responseText);",
                    "",
                    "            if(data.length === 0 || data[0].state.toLowerCase() === \"running\") {",
                    "                vmHostConstants.contextMenu.items.items[6].setDisabled(true);",
                    "            } else {",
                    "                vmHostConstants.contextMenu.items.items[6].setDisabled(false);",
                    "            }",
                    "",
                    "            vmHostConstants.contextMenu.showAt(position);",
                    "",
                    "        },",
                    "        failure: function (response) {",
                    "",
                    "            vmHostConstants.contextMenu.items.items[6].setDisabled(true);",
                    "            vmHostConstants.contextMenu.showAt(position);",
                    "",
                    "        }",
                    "    });",
                    "",
                    "",
                    "} else {",
                    "    e.stopEvent();",
                    "}"
                ],
                "name": "beforeitemcontextmenu",
                "scope": "me"
            },
            "designerId": "2fa462c4-1f46-47f7-ba0f-3f9ee4e1a422"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#listMenuPanel",
                "designer|targetType": "Ext.tree.Panel",
                "fn": "onListMenuPanelItemClick",
                "implHandler": [
                    "if(record.get(\"type\") === 'vmhost') {",
                    "    this.popVMHostInfoWindow(record);",
                    "} else {",
                    "    menuConstants.me.viewManagementMenu(record);",
                    "}"
                ],
                "name": "itemclick",
                "scope": "me"
            },
            "designerId": "51565ac2-914a-4c28-b687-9c60a1b25801"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "record"
                ],
                "fn": "popVMHostInfoWindow",
                "implHandler": [
                    "//VM Host Info 팝업 호출",
                    "",
                    "vmHostConstants.selectRecord = record;",
                    "",
                    "var popWindow = Ext.create(\"widget.VMHostInfoWindow\");",
                    "popWindow.show();",
                    "",
                    "popWindow.down(\"#VmHostName\").setText(record.get(\"text\"));",
                    "",
                    "var viewVmHostForm = Ext.getCmp(\"viewVmHostForm\");",
                    "",
                    "viewVmHostForm.getForm().reset();",
                    "viewVmHostForm.getForm().waitMsgTarget = viewVmHostForm.getEl();",
                    "",
                    "Ext.Ajax.request({",
                    "    url: GLOBAL.apiUrlPrefix + 'mon/vmhost/' + record.get(\"id\") + \"?detail=true\",",
                    "    method : 'GET',",
                    "    disableCaching : true,",
                    "    waitMsg: 'Loading...',",
                    "    success: function(response){",
                    "",
                    "        var data = Ext.JSON.decode(response.responseText);",
                    "",
                    "        if(data.length > 0) {",
                    "",
                    "            var hostData = data[0];",
                    "            var form = viewVmHostForm.getForm();",
                    "",
                    "            form.setValues(data[0]);",
                    "",
                    "            //하드웨어 정보",
                    "            var coreSocket = \"0\";",
                    "            var coreThread = \"0\";",
                    "            Ext.each(hostData.info, function(cpu){",
                    "",
                    "                if(cpu.name === \"CPU model\")",
                    "                    form.findField(\"cpuModel\").setValue(cpu.value);",
                    "",
                    "                else if(cpu.name === \"CPU(s)\")",
                    "                    form.findField(\"cpus\").setValue(cpu.value);",
                    "",
                    "                else if(cpu.name === \"CPU socket(s)\")",
                    "                    form.findField(\"cpuSocket\").setValue(cpu.value);",
                    "",
                    "                else if(cpu.name === \"Core(s) per socket\")",
                    "                    coreSocket = cpu.value;",
                    "",
                    "                else if(cpu.name === \"Thread(s) per core\")",
                    "                    coreThread = cpu.value;",
                    "",
                    "                else if(cpu.name === \"Memory size\")",
                    "                    form.findField(\"memSize\").setValue(cpu.value);",
                    "",
                    "            });",
                    "",
                    "            form.findField(\"cpuCore\").setValue(coreSocket + \"/\" + coreThread);",
                    "",
                    "            //Interface 정보",
                    "            Ext.getStore(\"VmHostInterfaceStore\").loadData(hostData.interfaces, false);",
                    "",
                    "            //VM정보",
                    "            Ext.each(hostData.version, function(vm){",
                    "",
                    "                if(vm.name === \"Running hypervisor\")",
                    "                    form.findField(\"hypervisor\").setValue(vm.value);",
                    "",
                    "                else if(vm.name === \"Using API\")",
                    "                    form.findField(\"vmApi\").setValue(vm.value);",
                    "",
                    "                else if(vm.name === \"Using library\")",
                    "                    form.findField(\"useLib\").setValue(vm.value);",
                    "",
                    "            });",
                    "",
                    "",
                    "        }",
                    "    }",
                    "});",
                    ""
                ]
            },
            "designerId": "556caaa4-03e5-4970-b156-48844a434cca"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "button"
                ],
                "fn": "createVMHost",
                "implHandler": [
                    "var addVmHostForm = Ext.getCmp(\"addVmHostForm\");",
                    "",
                    "if(addVmHostForm.isValid()) {",
                    "",
                    "    var sendData = addVmHostForm.getForm().getFieldValues();",
                    "",
                    "     Ext.Ajax.request({",
                    "         url: GLOBAL.apiUrlPrefix + \"vmhost\",",
                    "         method: \"POST\",",
                    "         headers : {",
                    "             \"Content-Type\" : \"application/json\"",
                    "         },",
                    "         waitMsg: 'Saving Data...',",
                    "         waitMsgTarget : addVmHostForm.getEl(),",
                    "         jsonData: sendData,",
                    "         success: function (response) {",
                    "             ",
                    "             if(response.status == 200) {",
                    "                 ",
                    "                 Ext.Msg.alert('Success', '등록이 완료되었습니다.');",
                    "                 ",
                    "                 menuConstants.me.renderServerTree();",
                    "                 addVmHostForm.up('window').close();",
                    "",
                    "             }",
                    "",
                    "        },",
                    "        failure: function (response) {",
                    "            Ext.Msg.alert('Failure', response.responseText);",
                    "        }",
                    "     });",
                    "",
                    "}",
                    ""
                ]
            },
            "designerId": "424279e2-7753-4fcb-97d8-10dac0bfe5c0"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "popAddVmWindow",
                "implHandler": [
                    "//VM 생성 팝업 호출",
                    "var popWindow = Ext.create(\"widget.AddVmWindow\");",
                    "popWindow.show();",
                    "",
                    "Ext.getCmp(\"addVmForm\").getForm().findField(\"vmhostId\").setValue(vmHostConstants.selectRecord.get(\"id\"));",
                    "Ext.getCmp(\"addVmForm\").getForm().findField(\"vmhostName\").setValue(vmHostConstants.selectRecord.get(\"text\"));",
                    "",
                    "var comboStore = Ext.getStore(\"ComboVmTemplateStore\");",
                    "comboStore.load({",
                    "    url : GLOBAL.apiUrlPrefix + 'vm/templatelist/' + vmHostConstants.selectRecord.get(\"id\")",
                    "});"
                ]
            },
            "designerId": "d15db7cd-2a01-4c8a-a82c-80615fbddb8e"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "button"
                ],
                "fn": "createVM",
                "implHandler": [
                    "var addVmForm = Ext.getCmp(\"addVmForm\");",
                    "",
                    "if(addVmForm.isValid()) {",
                    "",
                    "    var sendData = addVmForm.getForm().getFieldValues();",
                    "",
                    "    Ext.Ajax.request({",
                    "         url: GLOBAL.apiUrlPrefix + \"vm/clone\",",
                    "         method: \"POST\",",
                    "         headers : {",
                    "             \"Content-Type\" : \"application/json\"",
                    "         },",
                    "         waitMsg: 'Saving Data...',",
                    "         waitMsgTarget : addVmForm.getEl(),",
                    "         jsonData: sendData,",
                    "         success: function (response) {",
                    "",
                    "             if(response.status == 200) {",
                    "                 ",
                    "                 Ext.Msg.alert('Success', '등록이 완료되었습니다.');",
                    "                 ",
                    "                 menuConstants.me.renderServerTree();",
                    "                 addVmForm.up('window').close();",
                    "",
                    "             }",
                    "",
                    "        },",
                    "        failure: function (response) {",
                    "            Ext.Msg.alert('Failure', response.responseText);",
                    "        }",
                    "    });",
                    "",
                    "}",
                    ""
                ]
            },
            "designerId": "1f7d6385-bbba-40b9-aad0-764e824bda93"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "deleteVm",
                "implHandler": [
                    "",
                    "Ext.MessageBox.confirm('Confirm', 'VM을 삭제 하시겠습니까?', function(btn){",
                    "",
                    "    if(btn == \"yes\"){",
                    "",
                    "        Ext.Ajax.request({",
                    "            url: GLOBAL.apiUrlPrefix + \"vm/\" + vmHostConstants.actionRecord.get(\"id\"),",
                    "            method : \"DELETE\",",
                    "            disableCaching : true,",
                    "            waitMsg: 'Delete VM...',",
                    "            success: function(response){",
                    "",
                    "                if(response.status == 200) {",
                    "                    ",
                    "                    Ext.Msg.alert('Success', '삭제가 완료되었습니다.');",
                    "                    ",
                    "                    menuConstants.me.renderServerTree();",
                    "                    ",
                    "                }",
                    "",
                    "            }",
                    "        });",
                    "    }",
                    "",
                    "});",
                    ""
                ]
            },
            "designerId": "85bf23ac-c0a1-4037-8664-d69009327295"
        }
    ]
}