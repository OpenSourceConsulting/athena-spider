{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "VmHostController"
    },
    "designerId": "3283cfec-d919-4cd8-bb52-ac024c98ec9c",
    "cn": [
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "application"
                ],
                "fn": "init",
                "implHandler": [
                    "var vmHostTree = this;",
                    "",
                    "var vmHostContextMenu = new Ext.menu.Menu({",
                    "    items:",
                    "    [",
                    "        { text: 'NIC 관리',",
                    "         handler: function() {",
                    "             alert('NIC 관리');",
                    "         }",
                    "        },",
                    "        { text: '라우팅',",
                    "         handler: function() {",
                    "             alert('라우팅');",
                    "         }",
                    "        },",
                    "        { text: '파이어월',",
                    "         handler: function() {",
                    "             alert('파이어월');",
                    "         }",
                    "        },",
                    "        { text: 'NAT 관리',",
                    "         handler: function() {",
                    "             alert('NAT 관리');",
                    "         }",
                    "        },",
                    "        {",
                    "            xtype: 'menuseparator'",
                    "        },",
                    "        { text: 'VM 시작/중단',",
                    "         handler: function() {",
                    "             alert('VM 시작/중단');",
                    "         }",
                    "        }",
                    "    ]",
                    "",
                    "});",
                    "",
                    "//VM Host Tree Constants",
                    "Ext.define('vmHostConstants', {",
                    "    singleton: true,",
                    "    me : vmHostTree,",
                    "",
                    "    contextMenu: vmHostContextMenu,",
                    "    selectRecord : null",
                    "});"
                ]
            },
            "designerId": "41ca8b61-0d4f-4c20-85b8-41ed09d9d752"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "popAddVMHostWindow",
                "implHandler": [
                    "//VM Host 생성 팝업 호출",
                    "",
                    "var popWindow = Ext.create(\"widget.AddVmHostWindow\");",
                    "popWindow.show();"
                ]
            },
            "designerId": "83cf192e-5325-4af7-b31d-4cc82152576f"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#listMenuPanel",
                "designer|targetType": "Ext.tree.Panel",
                "fn": "onListMenuPanelBeforeItemContextMenu",
                "implHandler": [
                    "",
                    "var position = e.getXY();",
                    "e.stopEvent();",
                    "",
                    "vmHostConstants.contextMenu.showAt(position);"
                ],
                "name": "beforeitemcontextmenu",
                "scope": "me"
            },
            "designerId": "2fa462c4-1f46-47f7-ba0f-3f9ee4e1a422"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#listMenuPanel",
                "designer|targetType": "Ext.tree.Panel",
                "fn": "onListMenuPanelItemClick",
                "implHandler": [
                    "if(record.get(\"icon\").indexOf(\"server.png\") >= 0) {",
                    "    this.popVMHostInfoWindow(record);",
                    "} else {",
                    "    Ext.getCmp('managementBtn').fireEvent('click');",
                    "}"
                ],
                "name": "itemclick",
                "scope": "me"
            },
            "designerId": "51565ac2-914a-4c28-b687-9c60a1b25801"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "record"
                ],
                "fn": "popVMHostInfoWindow",
                "implHandler": [
                    "//VM Host Info 팝업 호출",
                    "vmHostConstants.selectRecord = record;",
                    "",
                    "var popWindow = Ext.create(\"widget.VMHostInfoWindow\");",
                    "popWindow.show();",
                    "",
                    "popWindow.down(\"#VmHostName\").setText(record.get(\"text\"));",
                    "",
                    "var viewVmHostForm = Ext.getCmp(\"viewVmHostForm\");",
                    "",
                    "viewVmHostForm.getForm().reset();",
                    "viewVmHostForm.getForm().waitMsgTarget = viewVmHostForm.getEl();",
                    "",
                    "Ext.Ajax.request({",
                    "    url: GLOBAL.apiUrlPrefix + 'mon/vmhost/' + record.get(\"id\") + \"?detail=true\",",
                    "    method : 'GET',",
                    "    disableCaching : true,",
                    "    waitMsg: 'Loading...',",
                    "    success: function(response){",
                    "        var data = Ext.JSON.decode(response.responseText);",
                    "        if(data.length > 0) {",
                    "            viewVmHostForm.getForm().setValues(data[0]);",
                    "        }",
                    "    }",
                    "});",
                    ""
                ]
            },
            "designerId": "556caaa4-03e5-4970-b156-48844a434cca"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "button"
                ],
                "fn": "createVMHost",
                "implHandler": [
                    "var addVmHostForm = Ext.getCmp(\"addVmHostForm\");",
                    "",
                    "if(addVmHostForm.isValid()) {",
                    "",
                    "    var sendData = addVmHostForm.getForm().getFieldValues();",
                    "",
                    "     Ext.Ajax.request({",
                    "         url: GLOBAL.apiUrlPrefix + \"vmhost\",",
                    "         method: \"POST\",",
                    "         headers : {",
                    "             \"Content-Type\" : \"application/json\"",
                    "         },",
                    "         waitMsg: 'Saving Data...',",
                    "         jsonData: sendData,",
                    "         success: function (response) {",
                    "",
                    "            alert(response.responseText + ' 등록이 완료되었습니다.');",
                    "",
                    "            menuConstants.me.renderServerTree();",
                    "            addVmHostForm.up('window').close();",
                    "",
                    "/*",
                    "            var responseData = Ext.JSON.decode(response.responseText);",
                    "             alert(responseData);",
                    "",
                    "             if(responseData.success) {",
                    "",
                    "                Ext.Msg.alert('Success', responseData.msg);",
                    "",
                    "                Ext.getCmp('almUserGrid').getStore().reload({",
                    "                    callback:function(records, operation, success){",
                    "",
                    "                        if(userId){",
                    "",
                    "                            Ext.each(records, function(record) {",
                    "",
                    "                                if(record.get(\"userId\") == userId) {",
                    "                                    Ext.getCmp('almUserGrid').getSelectionModel().select(record,true,false);",
                    "",
                    "                                    almConstants.selectRow = record;",
                    "                                    almConstants.me.selectAlmUserGrid();",
                    "                                }",
                    "",
                    "                            });",
                    "                        }",
                    "",
                    "                    }",
                    "                });",
                    "",
                    "                addVmHostForm.up('window').close();",
                    "",
                    "             } else {",
                    "",
                    "                Ext.Msg.alert('Failure', response.responseText);",
                    "",
                    "             }",
                    "             */",
                    "",
                    "        },",
                    "        failure: function (response) {",
                    "            Ext.Msg.alert('Failure', response.responseText);",
                    "        }",
                    "     });",
                    "",
                    "}",
                    "",
                    "/*",
                    "addVmHostForm.getForm().submit({",
                    "    clientValidation: true,",
                    "    url: GLOBAL.apiUrlPrefix + \"vmhost\",",
                    "    method : \"POST\",",
                    "    useDefaultXhrHeader: false,",
                    "    params: {",
                    "        newStatus: 'delivered'",
                    "    },",
                    "    waitMsg: 'Saving Data...',",
                    "    success: function(form, action) {",
                    "",
                    "        alert(Ext.decode(action.result));",
                    "        (Ext.Msg.alert('Success', action.result.msg);",
                    "",
                    "        Ext.getCmp('hypervisorGrid').getStore().load({",
                    "",
                    "            callback:function(records, operation, success){",
                    "",
                    "                if(hypervisorId) {",
                    "",
                    "                    Ext.each(records, function(record) {",
                    "",
                    "                        if(record.get(\"hypervisorId\") == hypervisorId) {",
                    "                            Ext.getCmp('hypervisorGrid').getSelectionModel().select(record,true,false);",
                    "",
                    "                            RHEVMConstants.selectRow = record;",
                    "                            RHEVMConstants.me.selectHypervisorGrid();",
                    "                        }",
                    "                    });",
                    "                }",
                    "            }",
                    "",
                    "        });",
                    "",
                    "        button.up('window').close();",
                    "    },",
                    "    failure: function(form, action) {",
                    "        switch (action.failureType) {",
                    "            case Ext.form.action.Action.CLIENT_INVALID:",
                    "            Ext.Msg.alert('Failure', '유효하지 않은 입력값이 존재합니다.');",
                    "            break;",
                    "            case Ext.form.action.Action.CONNECT_FAILURE:",
                    "            Ext.Msg.alert('Failure', 'Server communication failed');",
                    "            break;",
                    "            case Ext.form.action.Action.SERVER_INVALID:",
                    "            Ext.Msg.alert('Failure', action.result.msg);",
                    "        }",
                    "    }",
                    "});",
                    "",
                    "*/"
                ]
            },
            "designerId": "424279e2-7753-4fcb-97d8-10dac0bfe5c0"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "popAddVmWindow",
                "implHandler": [
                    "//VM 생성 팝업 호출",
                    "var popWindow = Ext.create(\"widget.AddVmWindow\");",
                    "popWindow.show();",
                    "",
                    "Ext.getCmp(\"addVmForm\").getForm().findField(\"vmhostId\").setValue(vmHostConstants.selectRecord.get(\"id\"));",
                    "Ext.getCmp(\"addVmForm\").getForm().findField(\"vmhostName\").setValue(vmHostConstants.selectRecord.get(\"text\"));",
                    "",
                    "var comboStore = Ext.getStore(\"ComboVmTemplateStore\");",
                    "comboStore.load({",
                    "    url : GLOBAL.apiUrlPrefix + 'vm/templatelist/' + vmHostConstants.selectRecord.get(\"id\")",
                    "});"
                ]
            },
            "designerId": "d15db7cd-2a01-4c8a-a82c-80615fbddb8e"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "button"
                ],
                "fn": "createVM",
                "implHandler": [
                    "var addVmForm = Ext.getCmp(\"addVmForm\");",
                    "",
                    "if(addVmForm.isValid()) {",
                    "",
                    "    var sendData = addVmForm.getForm().getFieldValues();",
                    "",
                    "     Ext.Ajax.request({",
                    "         url: GLOBAL.apiUrlPrefix + \"vm/clone\",",
                    "         method: \"POST\",",
                    "         headers : {",
                    "             \"Content-Type\" : \"application/json\"",
                    "         },",
                    "         waitMsg: 'Saving Data...',",
                    "         jsonData: sendData,",
                    "         success: function (response) {",
                    "",
                    "            alert(response.responseText + ' 등록이 완료되었습니다.');",
                    "",
                    "            menuConstants.me.renderServerTree();",
                    "            addVmForm.up('window').close();",
                    "",
                    "/*",
                    "            var responseData = Ext.JSON.decode(response.responseText);",
                    "             alert(responseData);",
                    "",
                    "             if(responseData.success) {",
                    "",
                    "                Ext.Msg.alert('Success', responseData.msg);",
                    "",
                    "                Ext.getCmp('almUserGrid').getStore().reload({",
                    "                    callback:function(records, operation, success){",
                    "",
                    "                        if(userId){",
                    "",
                    "                            Ext.each(records, function(record) {",
                    "",
                    "                                if(record.get(\"userId\") == userId) {",
                    "                                    Ext.getCmp('almUserGrid').getSelectionModel().select(record,true,false);",
                    "",
                    "                                    almConstants.selectRow = record;",
                    "                                    almConstants.me.selectAlmUserGrid();",
                    "                                }",
                    "",
                    "                            });",
                    "                        }",
                    "",
                    "                    }",
                    "                });",
                    "",
                    "                addVmHostForm.up('window').close();",
                    "",
                    "             } else {",
                    "",
                    "                Ext.Msg.alert('Failure', response.responseText);",
                    "",
                    "             }",
                    "             */",
                    "",
                    "        },",
                    "        failure: function (response) {",
                    "            Ext.Msg.alert('Failure', response.responseText);",
                    "        }",
                    "     });",
                    "",
                    "}",
                    ""
                ]
            },
            "designerId": "1f7d6385-bbba-40b9-aad0-764e824bda93"
        }
    ]
}